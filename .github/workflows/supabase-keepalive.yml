name: Supabase Keep-Alive

on:
  schedule:
    # æ¯é€±æœˆæ›œæ—¥ 9:00 (UTC) = æ—¥æœ¬æ™‚é–“ æœˆæ›œæ—¥ 18:00
    - cron: '0 9 * * 1'
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  keepalive:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Supabase Database
        run: |
          echo "Pinging Supabase to prevent auto-pause..."
          
          # Customersãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹
          RESPONSE=$(curl -s -w "\n%{http_code}" -X GET \
            "https://ciavfcyecpiejhfarfxl.supabase.co/rest/v1/customers?limit=1" \
            -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}")
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "âœ… Supabase is active and responding"
            echo "Response: $(echo "$RESPONSE" | head -n-1)"
          else
            echo "âš ï¸ Unexpected response code: $HTTP_CODE"
            exit 1
          fi
      
      - name: Ping Application
        run: |
          echo "Pinging application to ensure it's live..."
          
          APP_RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" \
            "https://kit-kobo-accounting.vercel.app/")
          
          if [ "$APP_RESPONSE" = "200" ]; then
            echo "âœ… Application is responding"
          else
            echo "âš ï¸ Application response code: $APP_RESPONSE"
          fi
      
      - name: Report Success
        run: |
          echo "ğŸ‰ Keep-alive completed successfully!"
          echo "Timestamp: $(date)"
